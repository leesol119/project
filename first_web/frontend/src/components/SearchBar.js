import React, { useState, useEffect, useRef } from 'react';
import { useNavigate, useParams, useLocation } from 'react-router-dom';

const companyList = [
    "AJ네트웍스","AK홀딩스","BGF","BGF리테일","BYC","CJ","CJ CGV","CJ대한통운","CJ씨푸드","CJ제일제당","CS홀딩스","DB","DB하이텍","DH오토넥스","DL","DL이앤씨","DN오토모티브","DRB동일","DSR","DSR제강","DS단석","DYP","E1","ESR켄달스퀘어리츠","F&F","F&F 홀딩스","GKL","GS","GS건설","GS글로벌","GS리테일","GS피앤엘","HDC","HDC랩스","HDC현대EP","HDC현대산업개발","HD한국조선해양","HD현대","HD현대건설기계","HD현대마린솔루션","HD현대마린엔진","HD현대미포","HD현대에너지솔루션","HD현대인프라코어","HD현대일렉트릭","HD현대중공업","HJ중공업","HL D&I","HLB글로벌","HL만도","HL홀딩스","HMM","HS애드","HS화성","HS효성","HS효성첨단소재","INVENI","JW생명과학","JW중외제약","JW홀딩스","KB발해인프라","KB스타리츠","KC그린홀딩스","KC코트렐","KEC","KG모빌리티","KG스틸","KG케미칼","KH 필룩스","KIB플러그에너지","KISCO홀딩스","KPX케미칼","KPX홀딩스","KR모터스","KSS해운","KTcs","KTis","LF","LG","LG디스플레이","LG생활건강","LG씨엔에스","LG에너지솔루션","LG유플러스","LG이노텍","LG전자","LG헬로비전","LG화학","LIG넥스원","LS","LS네트웍스","LS에코에너지","LX세미콘","LX인터내셔널","LX하우시스","LX홀딩스","MH에탄올","NAVER","NH올원리츠","NH프라임리츠","NICE","NICE평가정보","NI스틸","OCI","OCI홀딩스","PI첨단소재","PKC","POSCO홀딩스","S-Oil","SBS","SB성보","SGC에너지","SG글로벌","SG세계물산","SHD","SH에너지화학","SIMPAC","SJG세종","SK","SKC","SK가스","SK네트웍스","SK디스커버리","SK디앤디","SK리츠","SK바이오사이언스","SK스퀘어","SK아이이테크놀로지","SK오션플랜트","SK이노베이션","SK이터닉스","SK증권","SK케미칼","SK텔레콤","SK하이닉스","SNT다이내믹스","SNT모티브","SNT에너지","SNT홀딩스","SPC삼립","STX","STX그린로지스","STX엔진","SUN&L","TCC스틸","TP","TYM","WISCOM","YG PLUS","iM금융지주","가온전선","강남제비스코","강원랜드","갤럭시아에스엠","경농","경동나비엔","경동도시가스","경동인베스트","경방","경보제약","경인양행","경인전자","계룡건설산업","계양전기","고려산업","고려아연","고려제강","광동제약","광명전기","광전자","광주신세계","교촌에프앤비","국도화학","국보","국제약품","그린케미칼","극동유화","금강공업","금비","금양","금호건설","금호석유화학","금호에이치티","금호전기","금호타이어","기신정기","기아","까뮤이앤씨","깨끗한나라","남광토건","남선알미늄","남성","남양유업","남해화학","넥센","넥센타이어","넥스틸","넷마블","노루페인트","노루홀딩스","녹십자","녹십자홀딩스","농심","농심홀딩스","다스코","다우기술","다이나믹디자인","대교","대구백화점","대덕","대덕전자","대동","대동전자","대림바스","대림통상","대상","대상홀딩스","대성산업","대성에너지","대성홀딩스","대양금속","대영포장","대우건설","대웅","대웅제약","대원강업","대원전선","대원제약","대원화성","대유에이텍","대창","대창단조","대한방직","대한유화","대한전선","대한제강","대한제당","대한제분","대한항공","대한해운","대한화섬","대현","대호에이엘","더본코리아","더블유게임즈","더존비즈온","덕성","덴티움","도화엔지니어링","동국씨엠","동국제강","동국홀딩스","동남합성","동방","동방아그로","동부건설","동서","동성제약","동성케미컬","동아쏘시오홀딩스","동아에스티","동아지질","동양","동양고속","동양철관","동원F&B","동원금속","동원산업","동원수산","동원시스템즈","동인기연","동일고무벨트","동일산업","동일제강","동화약품","두산","두산로보틱스","두산밥캣","두산에너빌리티","두산퓨얼셀","두올","드림텍","디씨엠","디아이","디아이동일","디아이씨","디앤디플랫폼리츠","디와이","디와이덕양","디와이파워","롯데관광개발","롯데렌탈","롯데리츠","롯데손해보험","롯데쇼핑","롯데에너지머티리얼즈","롯데웰푸드","롯데이노베이트","롯데정밀화학","롯데지주","롯데칠성음료","롯데케미칼","롯데하이마트","마니커","마스턴프리미어리츠","만호제강","맥쿼리인프라","맵스리얼티1","메타랩스","메타케어","명문제약","명신산업","모나리자","모나미","모나용평","모토닉","무림P&P","무림페이퍼","무학","문배철강","미래산업","미래아이앤지","미래에셋글로벌리츠","미래에셋맵스리츠","미스토홀딩스","미원상사","미원에스씨","미원홀딩스","미원화학","미창석유공업","바이오노트","방림","백산","범양건영","벽산","보락","보령","보해양조","부광약품","부국철강","부산산업","부산주공","비비안","비상교육","비에이치","빙그레","사조대림","사조동아원","사조산업","사조씨푸드","사조오양","산일전기","삼부토건","삼성E&A","삼성FN리츠","삼성SDI","삼성공조","삼성물산","삼성바이오로직스","삼성에스디에스","삼성전기","삼성전자","삼성제약","삼성중공업","삼성출판사","삼아알미늄","삼양사","삼양식품","삼양통상","삼양패키징","삼양홀딩스","삼영","삼영무역","삼영전자공업","삼원강재","삼익THK","삼익악기","삼일씨엔에스","삼일제약","삼정펄프","삼진제약","삼천리","삼호개발","삼화왕관","삼화전기","삼화전자공업","삼화콘덴서공업","삼화페인트공업","상신브레이크","새론오토모티브","샘표","샘표식품","서연","서연이화","서울도시가스","서울식품공업","서원","서흥","선도전기","선진","성문전자","성신양회","성안머티리얼스","성창기업지주","세기상사","세방","세방전지","세아베스틸지주","세아제강","세아제강지주","세아특수강","세아홀딩스","세우글로벌","세원이앤씨","세원정공","세이브존I&C","세진중공업","셀트리온","솔루스첨단소재","솔루엠","송원산업","수산세보틱스","수산인더스트리","스타에스엠리츠","스틱인베스트먼트","시디즈","시알홀딩스","시프트업","신대양제지","신도리코","신라교역","신성이엔지","신성통상","신세계","신세계I&C","신세계인터내셔날","신세계푸드","신송홀딩스","신영와코루","신원","신일전자","신풍","신풍제약","신한글로벌액티브리츠","신한서부티엔디리츠","신한알파리츠","신흥","쌍방울","써니전자","쏘카","씨아이테크","씨에스윈드","씨케이솔루션","씨티알모빌리티","아남전자","아모레퍼시픽","아모레퍼시픽홀딩스","아세아","아세아시멘트","아세아제지","아센디오","아시아나IDT","아시아나항공","아이마켓코리아","아이에스동서","아이에이치큐","아이티센씨티에스","아주스틸","아진전자부품","알루코","애경산업","애경케미칼","에넥스","에스디바이오센서","에스엘","에스엠벡셀","에스원","에스제이엠","에스제이엠홀딩스","에스케이바이오팜","에쓰씨엔지니어링","에어부산","에이리츠","에이블씨엔씨","에이엔피","에이프로젠","에이프로젠바이오로직스","에이플러스에셋","에이피알","에코프로머티","엑시큐어하이트론","엔씨소프트","엔에이치엔","엔케이","엔피씨","엘브이엠씨","엘앤에프","엘에스일렉트릭","엠씨넥스","엠앤씨솔루션","영보화학","영원무역","영원무역홀딩스","영진약품","영풍","영풍제지","영화금속","영흥","오뚜기","오리엔트바이오","오리온","오리온홀딩스","온타이드","와이투솔루션","우성","우신시스템","우진","우진아이엔에스","우진플라임","웅진","웅진씽크빅","원림","웰바이오텍","윌비스","유나이티드","유니드","유니드비티플러스","유니온","유니온머티리얼","유니켐","유니퀘스트","유성기업","유수홀딩스","유엔젤","유유제약","유한양행","율촌화학","이건산업","이구산업","이노션","이리츠코크렙","이마트","이수스페셜티케미컬","이수페타시스","이수화학","이스타코","이아이디","이엔플러스","이연제약","이월드","이지스레지던스리츠","이지스밸류플러스리츠","이화산업","인디에프","인바이오젠","인스코비","인지컨트롤스","인천도시가스","인터지스","인팩","일동제약","일동홀딩스","일성건설","일성아이에스","일신방직","일신석재","일양약품","일정실업","일진다이아","일진디스플","일진전기","일진하이솔루스","일진홀딩스","잇츠한불","자이에스앤디","자화전자","전방","전진건설로봇","제이알글로벌리츠","제이에스코퍼레이션","제이준코스메틱","제일기획","제일약품","제일연마","제일파마홀딩스","제주항공","조광페인트","조광피혁","조비","조선내화","조선선재","조일알미늄","조흥","종근당","종근당바이오","종근당홀딩스","주성코퍼레이션","주연테크","지누스","지엠비코리아","지역난방공사","진도","진양산업","진양폴리우레탄","진양홀딩스","진양화학","진에어","진원생명과학","진흥기업","참엔지니어링","천일고속","청호ICT","체시스","카카오","카프로","케이비아이동국실업","케이씨","케이씨씨","케이씨씨글라스","케이씨텍","케이씨티시","케이카","케이탑리츠","케이티","케이티스카이라이프","케이티앤지","코람코더원리츠","코람코라이프인프라리츠","코리아써키트","코스맥스","코스맥스비티아이","코스모신소재","코스모화학","코아스","코오롱","코오롱ENP","코오롱글로벌","코오롱모빌리티그룹","코오롱인더","코웨이","콘텐트리중앙","콜마홀딩스","쿠쿠홀딩스","쿠쿠홈시스","크라운제과","크라운해태홀딩스","크래프톤","키다리스튜디오","태경비케이","태경산업","태경케미컬","태광산업","태림포장","태양금속공업","태영건설","태원물산","테이팩스","텔코웨어","토니모리","티비에이치글로벌","티에이치엔","티와이홀딩스","티웨이항공","티웨이홀딩스","티케이지휴켐스","파라다이스","파미셀","팜스코","팜젠사이언스","팬오션","퍼스텍","퍼시스","페이퍼코리아","평화산업","평화홀딩스","포스코DX","포스코스틸리온","포스코인터내셔널","포스코퓨처엠","풀무원","풍산","풍산홀딩스","프레스티지바이오파마","플레이그램","하나제약","하나투어","하이브","하이스틸","하이트진로","하이트진로홀딩스","한국ANKOR유전","한국가스공사","한국공항","한국내화","한국단자공업","한국무브넥스","한국석유공업","한국수출포장공업","한국쉘석유","한국앤컴퍼니","한국전력공사","한국전자홀딩스","한국제지","한국종합기술","한국주강","한국주철관공업","한국철강","한국카본","한국콜마","한국타이어앤테크놀로지","한국특강","한국항공우주","한국화장품","한국화장품제조","한농화성","한독","한미글로벌","한미반도체","한미사이언스","한미약품","한샘","한섬","한성기업","한세실업","한세엠케이","한세예스24홀딩스","한솔로지스틱스","한솔제지","한솔케미칼","한솔테크닉스","한솔피엔에스","한솔홀딩스","한솔홈데코","한신공영","한신기계공업","한온시스템","한올바이오파마","한익스프레스","한일시멘트","한일철강","한일현대시멘트","한일홀딩스","한전KPS","한전기술","한전산업","한진","한진중공업홀딩스","한진칼","한창","한창제지","한컴라이프케어","한화","한화갤러리아","한화리츠","한화비전","한화솔루션","한화시스템","한화에어로스페이스","한화엔진","한화오션","해성디에스","해태제과식품","핸즈코퍼레이션","현대건설","현대그린푸드","현대글로비스","현대로템","현대리바트","현대모비스","현대백화점","현대비앤지스틸","현대약품","현대엘리베이터","현대오토에버","현대위아","현대자동차","현대제철","현대지에프홀딩스","현대코퍼레이션","현대코퍼레이션홀딩스","현대퓨처넷","현대홈쇼핑","형지엘리트","혜인","호전실업","호텔신라","화승알앤에이","화승엔터프라이즈","화승인더스트리","화승코퍼레이션","화신","화인베스틸","화천기계","화천기공","환인제약","황금에스티","효성","효성 ITX","효성중공업","효성티앤씨","효성화학","후성","휴니드테크놀러지스","휴비스","휴스틸","흥아해운"
    ];
    
    function SearchBar() {
      const { companyName } = useParams(); // ✅ 현재 URL 파라미터
      const location = useLocation(); // ✅ 현재 경로 확인
      const navigate = useNavigate();
    
      const [query, setQuery] = useState('');
      const [suggestions, setSuggestions] = useState([]);
      const [highlightedIndex, setHighlightedIndex] = useState(-1);
    
      const ulRef = useRef(null);
    
      // ✅ 페이지가 바뀔 때마다 URL에서 회사명 받아와 검색창에 유지
      useEffect(() => {
        if (companyName) {
          const decoded = decodeURIComponent(companyName);
          setQuery(decoded);
        }
      }, [companyName, location.pathname]);
    
      const handleChange = (e) => {
        const value = e.target.value;
        setQuery(value);
        if (value.length > 0) {
          const filtered = companyList.filter((company) =>
            company.toLowerCase().includes(value.toLowerCase())
          );
          setSuggestions(filtered);
          setHighlightedIndex(-1);
        } else {
          setSuggestions([]);
        }
      };
    
      const handleSelect = (name) => {
        setQuery(name); // ✅ 입력창에도 반영되도록 추가
        navigate(`/company/${encodeURIComponent(name)}/financials`);
        setSuggestions([]);
        setHighlightedIndex(-1);
      };
    
      const handleSubmit = (e) => {
        e.preventDefault();
        if (highlightedIndex >= 0 && suggestions[highlightedIndex]) {
          handleSelect(suggestions[highlightedIndex]);
        } else if (query.trim()) {
          handleSelect(query.trim());
        }
      };
    
      const handleKeyDown = (e) => {
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          setHighlightedIndex((prev) => Math.min(prev + 1, suggestions.length - 1));
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          setHighlightedIndex((prev) => Math.max(prev - 1, 0));
        } else if (e.key === 'Enter') {
          e.preventDefault();
          if (highlightedIndex >= 0 && suggestions[highlightedIndex]) {
            handleSelect(suggestions[highlightedIndex]);
          } else {
            handleSubmit(e);
          }
        }
      };
    
      return (
        <div className="relative w-96">
          <form onSubmit={handleSubmit} className="flex items-center gap-2">
            <input
              type="text"
              value={query}
              onChange={handleChange}
              onKeyDown={handleKeyDown}
              placeholder="회사명을 입력하세요"
              className="flex-1 p-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
            />
          <button
            type="submit"
            className="px-4 py-2 text-base rounded-md bg-gradient-to-r from-blue-400 to-blue-600 text-white shadow-md hover:brightness-110 transition"
          >
            검색
          </button>
          </form>
    
          {suggestions.length > 0 && (
            <ul
              ref={ulRef}
              className="absolute z-50 left-0 right-0 bg-white border rounded mt-1 shadow-md max-h-60 overflow-y-auto"
            >
              {suggestions.map((company, index) => (
                <li
                  key={company}
                  onClick={() => handleSelect(company)}
                  className={`px-4 py-2 cursor-pointer ${
                    index === highlightedIndex ? 'bg-blue-100 font-semibold' : ''
                  }`}
                >
                  {company}
                </li>
              ))}
            </ul>
          )}
        </div>
      );
    }
    
    export default SearchBar;